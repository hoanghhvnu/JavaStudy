package hoanghh.study.network;

import java.net.*;
import java.text.ParseException;
import java.util.ArrayList;
import java.util.List;
import java.io.*;

import org.json.JSONObject;

import vn.com.datasection.file.FileUtils;

public class HTTPRequestExample {

    public static void main(String[] args) {

        // System.setProperty(String, String);
        // String ids =
        // "877642985616111,855705464450990,602442193235584,764590063614593,684090125040703,666830123430682,1109977579019644,687680131348983,506263046195067,1666430720257635,701000176662140,294886634053053,542187849249812,453718128111139,1617262998550809,526717234131716,578133668983954,858793444165714,1539243799659348,1559286770955431,384075781754934,787463964660578,1584782205091319,307880992755182,391071607714197,609422265857414,458569267657797,1445078035791706,1555514401359261,1605451533064015,1454569538171876,1456344624683409,877642985616111,855705464450990,10100643296116955,1598125063775151,389247344558692,1598125063775151,389247344558692,1500754940189404,10203070270666267,1449271148726224,884437114945978,408848309266111,1591829767711441,1659922920917699,809458985785725,471244506351608,317586271776180,808220752584747,670460326389357,494031324083277,1554283224806907,924952634235321,643314209110908,1561500920764574,438541459648452,1669662786586662,601639726644993,380063552169498,104637149881683,371970522963209,912477152095808,826090567455263,1425561394437484,379909502166541,10202061163130304,506890632747852,838895869483891,634732179964226,1572749816288330,1512472668992443,586716541457968,10203512956244130,580691535411013,1549915668557454,359363260890116,1380055622318284,1518377628430496,368896426612062,386611458180408,741341212639778,1440207399634851,1551077801798964,395265333967997,1614584682158018,1582232375387391,659579817479228,1582934638616499,1546049905647614,411398392370784,273360516207897,1546219308985385,10204373955367291,362443400610379,680780645370154,417952005027516,1519110685001408,878170498867513,314151268775516,673289049482365,574398182698482,581043455362200,806126279423168,749899838422816,475535129252239,593961730708014,1000266696709994,706088029512941,621641344648546,712940295486360,876498195776514,310534395798938,312367492292839,652131394907601,425814680905358,116975235308300,1550353165182159,506014069541298,714307468673286,1415108642153258,1547929512140066,507134586094259,307039469495008,396019220607407,853021208148158,308394739350312,946770365395701,396389923854537,394609834034241,1577145675833195,729336330479530,365444973633167,1868256203399441,348788538614922,947210611959068,10206258585848677,393206910838314,10153614825694897,298259817035751,1591349281088007,702387209869359,597598617050105,1002293249787355,1691762357709327,606385796136786,378031139022495,678766672243412,1587367681484778,415811588613971,348682688654773,599477723530499,623362471126422,971535696194730,493193867502831,397617217061977,510043702469551,1546385722252875,497025740440184,425627414273727,619911651470904,1606584072920737,758540770905737,384944985039446,379998912164153,1031777896851941,957418370944553,406863566172196,10152774123143501,330565143793045,109824916026604,440402342777303,1585564271731951,926194747410716,401758056645275,10203356194529222,705626209534796,888699277815197,651800861603962,1436867383277264,889738617711507,1445077405816013,454000661415367,600006176810259,503131173172202,608883109255465,682167181891655,1724180994475594,413549635468607,1612256869010776,1513930085556624,1414568102199615,1587583201523500,1657236761166607,1555608254657068,522071841274410,887769817921901,396628427176493,695301593935564,380993428748771,1504544076483024,10201892143345415,797987823602281,897082546981989,1515006338779933,516071815216483,889100431102739,1533216396895582,10152554795006646,788996474479831,490512624423330,370816143080384,10204052554208023,10204601709544508,839601889393356,545515472252084,551565628309403,342500849292106,1637937149781111,1733670273524858,354209784750936,848562421894969,614171495383009,471110483037606,4777799978547,400916093395008,834765166562517,663471343768279,978550082155084,419589708188890,1415060878824737,404307159718043,1754783218080047,1599761023619642,283952858471969,110642709277709,415929118558924,479271128877915,702128513236458,794319797349531,1624873337750150,1423068668008053,1513054218952902,125450911121953,10153000791607732,689109681221252,930441680299492,1503041339960929,1560367584178650,612262872212450,410737615767485,478483188958857,1526358480968724,1417152668603113,1566305453600213,1540029429594899,370074896486821,484229241735865,463541077139216,757414377664342,501314636700714,362496133922106,10205277438638173,880481602016930,349227635262354,552500874893625,321195564737454,1509803965938419,682308235235462,296500147226418,1561205877425062,1584053895151801,1525133251093865,310591695817143,1612601142356317,780124805378661,481203012022523,291335214399213,367561943400048,432068746961252,1622983591252929,1621949884718416,297174980493648,893420684009798,1478364909141882,1516599068578023,784747468247493,1555580298015867,1588674774688770,614806725295690,784460718311908,1485433808405030,828642897158202,117320985272020,720025044738626,556767254459731,937592366260542";
        // URL yahoo = new URL(
        // "https://graph.facebook.com/picture?ids=877642985616111,855705464450990,602442193235584,764590063614593,684090125040703,666830123430682,1109977579019644,687680131348983,506263046195067,1666430720257635,701000176662140,294886634053053,542187849249812,453718128111139,1617262998550809,526717234131716,578133668983954,858793444165714,1539243799659348,1559286770955431,384075781754934,787463964660578,1584782205091319,307880992755182,391071607714197,609422265857414,458569267657797,1445078035791706,1555514401359261,1605451533064015,1454569538171876,1456344624683409,877642985616111,855705464450990,10100643296116955,1598125063775151,389247344558692,1598125063775151,389247344558692,1500754940189404,10203070270666267,1449271148726224,884437114945978,408848309266111,1591829767711441,1659922920917699,809458985785725,471244506351608,317586271776180,808220752584747,670460326389357,494031324083277,1554283224806907,924952634235321,643314209110908,1561500920764574,438541459648452,1669662786586662,601639726644993,380063552169498,104637149881683,371970522963209,912477152095808,826090567455263,1425561394437484,379909502166541,10202061163130304,506890632747852,838895869483891,634732179964226,1572749816288330,1512472668992443,586716541457968,10203512956244130,580691535411013,1549915668557454,359363260890116,1380055622318284,1518377628430496,368896426612062,386611458180408,741341212639778,1440207399634851,1551077801798964,395265333967997,1614584682158018,1582232375387391,659579817479228,1582934638616499,1546049905647614,411398392370784,273360516207897,1546219308985385,10204373955367291,362443400610379,680780645370154,417952005027516,1519110685001408,878170498867513,314151268775516,673289049482365,574398182698482,581043455362200,806126279423168,749899838422816,475535129252239,593961730708014,1000266696709994,706088029512941,621641344648546,712940295486360,876498195776514,310534395798938,312367492292839,652131394907601,425814680905358,116975235308300,1550353165182159,506014069541298,714307468673286,1415108642153258,1547929512140066,507134586094259,307039469495008,396019220607407,853021208148158,308394739350312,946770365395701,396389923854537,394609834034241,1577145675833195,729336330479530,365444973633167,1868256203399441,348788538614922,947210611959068,10206258585848677,393206910838314,10153614825694897,298259817035751,1591349281088007,702387209869359,597598617050105,1002293249787355,1691762357709327,606385796136786,378031139022495,678766672243412,1587367681484778,415811588613971,348682688654773,599477723530499,623362471126422,971535696194730,493193867502831,397617217061977,510043702469551,1546385722252875,497025740440184,425627414273727,619911651470904,1606584072920737,758540770905737,384944985039446,379998912164153,1031777896851941,957418370944553,406863566172196,10152774123143501,330565143793045,109824916026604,440402342777303,1585564271731951,926194747410716,401758056645275,10203356194529222,705626209534796,888699277815197,651800861603962,1436867383277264,889738617711507,1445077405816013,454000661415367,600006176810259,503131173172202,608883109255465,682167181891655,1724180994475594,413549635468607,1612256869010776,1513930085556624,1414568102199615,1587583201523500,1657236761166607,1555608254657068,522071841274410,887769817921901,396628427176493,695301593935564,380993428748771,1504544076483024,10201892143345415,797987823602281,897082546981989,1515006338779933,516071815216483,889100431102739,1533216396895582,10152554795006646,788996474479831,490512624423330,370816143080384,10204052554208023,10204601709544508,839601889393356,545515472252084,551565628309403,342500849292106,1637937149781111,1733670273524858,354209784750936,848562421894969,614171495383009,471110483037606,4777799978547,400916093395008,834765166562517,663471343768279,978550082155084,419589708188890,1415060878824737,404307159718043,1754783218080047,1599761023619642,283952858471969,110642709277709,415929118558924,479271128877915,702128513236458,794319797349531,1624873337750150,1423068668008053,1513054218952902,125450911121953,10153000791607732,689109681221252,930441680299492,1503041339960929,1560367584178650,612262872212450,410737615767485,478483188958857,1526358480968724,1417152668603113,1566305453600213,1540029429594899,370074896486821,484229241735865,463541077139216,757414377664342,501314636700714,362496133922106,10205277438638173,880481602016930,349227635262354,552500874893625,321195564737454,1509803965938419,682308235235462,296500147226418,1561205877425062,1584053895151801,1525133251093865,310591695817143,1612601142356317,780124805378661,481203012022523,291335214399213,367561943400048,432068746961252,1622983591252929,1621949884718416,297174980493648,893420684009798,1478364909141882,1516599068578023,784747468247493,1555580298015867,1588674774688770,614806725295690,784460718311908,1485433808405030,828642897158202,117320985272020,720025044738626,556767254459731,937592366260542&method=GET&redirect=false");
        // System.setProperty("proxySet", "true");
        // System.setProperty("https.proxyHost", "101.99.18.238");
        // System.setProperty("https.proxyPort", "8080");
        // System.setProperty("java.net.useSystemProxies", "true");
        List<Proxy> proxies = parseProxy(new File("input/proxies.txt"));
        for (Proxy proxy : proxies) {
            run(proxy);
        }
        
    }

    public static void run(Proxy proxy) {
        try {
//            SocketAddress addr = new InetSocketAddress("91.121.202.110", 3128);
//            Proxy proxy = new Proxy(Proxy.Type.HTTP, addr);

            URL yahoo = new URL("https://api.ipify.org/?format=text");
            URLConnection yc = yahoo.openConnection(proxy);
            // URLConnection yc = yahoo.openConnection();

            try (BufferedReader in = new BufferedReader(new InputStreamReader(yc.getInputStream()))) {
                String inputLine;
                String result = "";
                while ((inputLine = in.readLine()) != null) {
                    result = inputLine;
                    System.out.println(result);
                    // break;
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        } catch (Exception e) {
            e.printStackTrace();
        } // end try
    } // end method

    public static List<Proxy> parseProxy(File file) {
        List<Proxy> ret = new ArrayList<>();
        for (String line : FileUtils.getContent(file)) {
            try {
                String els[] = line.split("\t");
                String host = els[0];
                String port = els[1];
                SocketAddress addr = new InetSocketAddress(host, Integer.parseInt(port));
                Proxy proxy = new Proxy(Proxy.Type.HTTP, addr);

                ret.add(proxy);
            } catch (ArrayIndexOutOfBoundsException | NumberFormatException e) {
                e.printStackTrace();
            }

        } // end for

        return ret;
    } // end method

}
